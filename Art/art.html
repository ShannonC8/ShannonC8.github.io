<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Art</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="./art.css" rel="stylesheet" type="text/css" media="all" />
  </head>
  <body>
    <div class="desk">
      <a class="corner-button" href="../homepage/homepage.html" aria-label="Go back">
        ← Back
      </a>

      <main class="table" role="main">
        <section class="viewer" aria-live="polite">
          <div class="viewer-inner">
            <p id="viewerMsg">Select a sketchbook ↓</p>
            <img id="viewerImg" alt="Sketchbook page" />
          </div>
          <div class="controls" aria-label="Page controls">
            <button class="prev" aria-label="Previous page" disabled>&lt;</button>
            <span class="page-indicator" aria-live="polite" id="pageIndicator">— / —</span>
            <button class="next" aria-label="Next page" disabled>&gt;</button>
          </div>
        </section>

        <div class="stacks" aria-hidden="true">
          <div class="sketchbook1">
            <img data-src="./images/sketchbook1/0 0.png" alt="Sketchbook 1 page 0" />
            <img data-src="./images/sketchbook1/0.png" alt="Sketchbook 1 page 0b" />
            <img data-src="./images/sketchbook1/1.png" alt="Sketchbook 1 page 1" />
            <img data-src="./images/sketchbook1/2.png" alt="Sketchbook 1 page 2" />
            <img data-src="./images/sketchbook1/3.png" alt="Sketchbook 1 page 3" />
            <img data-src="./images/sketchbook1/4.png" alt="Sketchbook 1 page 4" />
            <img data-src="./images/sketchbook1/5.png" alt="Sketchbook 1 page 5" />
            <img data-src="./images/sketchbook1/6.png" alt="Sketchbook 1 page 6" />
            <img data-src="./images/sketchbook1/7.png" alt="Sketchbook 1 page 7" />
            <img data-src="./images/sketchbook1/8.png" alt="Sketchbook 1 page 8" />
            <img data-src="./images/sketchbook1/9.png" alt="Sketchbook 1 page 9" />
            <img data-src="./images/sketchbook1/10.png" alt="Sketchbook 1 page 10" />
            <img data-src="./images/sketchbook1/11.png" alt="Sketchbook 1 page 11" />
            <img data-src="./images/sketchbook1/12.png" alt="Sketchbook 1 page 12" />
            <img data-src="./images/sketchbook1/13.png" alt="Sketchbook 1 page 13" />
            <img data-src="./images/sketchbook1/14.png" alt="Sketchbook 1 page 14" />
            <img data-src="./images/sketchbook1/15.png" alt="Sketchbook 1 page 15" />
            <img data-src="./images/sketchbook1/16.png" alt="Sketchbook 1 page 16" />
            <img data-src="./images/sketchbook1/17.png" alt="Sketchbook 1 page 17" />
            <img data-src="./images/sketchbook1/18.png" alt="Sketchbook 1 page 18" />
            <img data-src="./images/sketchbook1/19.png" alt="Sketchbook 1 page 19" />
            <img data-src="./images/sketchbook1/20.png" alt="Sketchbook 1 page 20" />
            <img data-src="./images/sketchbook1/21.png" alt="Sketchbook 1 page 21" />
            <img data-src="./images/sketchbook1/22.png" alt="Sketchbook 1 page 22" />
            <img data-src="./images/sketchbook1/23.png" alt="Sketchbook 1 page 23" />
            <img data-src="./images/sketchbook1/24.png" alt="Sketchbook 1 page 24" />
            <img data-src="./images/sketchbook1/25.png" alt="Sketchbook 1 page 25" />
            <img data-src="./images/sketchbook1/26.png" alt="Sketchbook 1 page 26" />
            <img data-src="./images/sketchbook1/27.png" alt="Sketchbook 1 page 27" />
            <img data-src="./images/sketchbook1/28.png" alt="Sketchbook 1 page 28" />
            <img data-src="./images/sketchbook1/29.png" alt="Sketchbook 1 page 29" />
            <img data-src="./images/sketchbook1/30.png" alt="Sketchbook 1 page 30" />
            <img data-src="./images/sketchbook1/31.png" alt="Sketchbook 1 page 31" />
            <img data-src="./images/sketchbook1/32.png" alt="Sketchbook 1 page 32" />
            <img data-src="./images/sketchbook1/33.png" alt="Sketchbook 1 page 33" />
            <img data-src="./images/sketchbook1/34.png" alt="Sketchbook 1 page 34" />
            <img data-src="./images/sketchbook1/35.png" alt="Sketchbook 1 page 35" />
            <img data-src="./images/sketchbook1/36.png" alt="Sketchbook 1 page 36" />
            <img data-src="./images/sketchbook1/37.png" alt="Sketchbook 1 page 37" />
            <img data-src="./images/sketchbook1/38.png" alt="Sketchbook 1 page 38" />
            <img data-src="./images/sketchbook1/39.png" alt="Sketchbook 1 page 39" />
            <img data-src="./images/sketchbook1/40.png" alt="Sketchbook 1 page 40" />
            <img data-src="./images/sketchbook1/41.png" alt="Sketchbook 1 page 41" />
            <img data-src="./images/sketchbook1/42.png" alt="Sketchbook 1 page 42" />
            <img data-src="./images/sketchbook1/43.png" alt="Sketchbook 1 page 43" />
            <img data-src="./images/sketchbook1/44.png" alt="Sketchbook 1 page 44" />
            <img data-src="./images/sketchbook1/45.png" alt="Sketchbook 1 page 45" />
          </div>

          <div class="sketchbook2">
            <img data-src="./images/sketchbook2/0.png" alt="Sketchbook 2 page 0" />
            <img data-src="./images/sketchbook2/1.png" alt="Sketchbook 2 page 1" />
            <img data-src="./images/sketchbook2/2.png" alt="Sketchbook 2 page 2" />
            <img data-src="./images/sketchbook2/3.png" alt="Sketchbook 2 page 3" />
            <img data-src="./images/sketchbook2/4.png" alt="Sketchbook 2 page 4" />
            <img data-src="./images/sketchbook2/5.png" alt="Sketchbook 2 page 5" />
            <img data-src="./images/sketchbook2/6.png" alt="Sketchbook 2 page 6" />
            <img data-src="./images/sketchbook2/7.png" alt="Sketchbook 2 page 7" />
            <img data-src="./images/sketchbook2/8.png" alt="Sketchbook 2 page 8" />
            <img data-src="./images/sketchbook2/9.png" alt="Sketchbook 2 page 9" />
            <img data-src="./images/sketchbook2/10.png" alt="Sketchbook 2 page 10" />
            <img data-src="./images/sketchbook2/11.png" alt="Sketchbook 2 page 11" />
            <img data-src="./images/sketchbook2/12.png" alt="Sketchbook 2 page 12" />
            <img data-src="./images/sketchbook2/13.png" alt="Sketchbook 2 page 13" />
            <img data-src="./images/sketchbook2/14.png" alt="Sketchbook 2 page 14" />
            <img data-src="./images/sketchbook2/15.png" alt="Sketchbook 2 page 15" />
            <img data-src="./images/sketchbook2/16.png" alt="Sketchbook 2 page 16" />
            <img data-src="./images/sketchbook2/17.png" alt="Sketchbook 2 page 17" />
            <img data-src="./images/sketchbook2/18.png" alt="Sketchbook 2 page 18" />
            <img data-src="./images/sketchbook2/19.png" alt="Sketchbook 2 page 19" />
            <img data-src="./images/sketchbook2/20.png" alt="Sketchbook 2 page 20" />
            <img data-src="./images/sketchbook2/21.png" alt="Sketchbook 2 page 21" />
            <img data-src="./images/sketchbook2/22.png" alt="Sketchbook 2 page 22" />
            <img data-src="./images/sketchbook2/23.png" alt="Sketchbook 2 page 23" />
            <img data-src="./images/sketchbook2/24.png" alt="Sketchbook 2 page 24" />
            <img data-src="./images/sketchbook2/25.png" alt="Sketchbook 2 page 25" />
            <img data-src="./images/sketchbook2/26.png" alt="Sketchbook 2 page 26" />
            <img data-src="./images/sketchbook2/27.png" alt="Sketchbook 2 page 27" />
            <img data-src="./images/sketchbook2/28.png" alt="Sketchbook 2 page 28" />
            <img data-src="./images/sketchbook2/29.png" alt="Sketchbook 2 page 29" />
            <img data-src="./images/sketchbook2/30.png" alt="Sketchbook 2 page 30" />
            <img data-src="./images/sketchbook2/31.png" alt="Sketchbook 2 page 31" />
            <img data-src="./images/sketchbook2/32.png" alt="Sketchbook 2 page 32" />
          </div>
        </div>

        <nav class="chooseSketch" aria-label="Choose a sketchbook">
          <div class="choice">
            <img
              data-target="sketchbook1"
              src="images/sketchbook1/0 0.png"
              alt="Open Sketchbook 1"
            />
            <p>Sketchbook 1</p>
          </div>
          <div class="choice">
            <img
              data-target="sketchbook2"
              src="images/sketchbook2/0.png"
              alt="Open Sketchbook 2"
            />
            <p>Sketchbook 2</p>
          </div>
          <button class="to-gallery" onclick="location.href='gallery/gallery.html'">
            <img src="images/pic9.png" alt="Gallery"/>
            <p>To gallery</p>
          </button>
        </nav>
      </main>
    </div>

    <script>
      (function () {
        const viewerImg = document.getElementById("viewerImg");
        const viewerMsg = document.getElementById("viewerMsg");
        const prevBtn = document.querySelector(".controls .prev");
        const nextBtn = document.querySelector(".controls .next");
        const indicator = document.getElementById("pageIndicator");

        // Read data-src from the hidden stacks (prevents network fetch of hidden images)
        const pagesFromStack = (selector) =>
          Array.from(document.querySelectorAll(selector + " img"))
            .map((img) => img.dataset.src)
            .filter(Boolean);

        const books = {
          sketchbook1: pagesFromStack(".sketchbook1"),
          sketchbook2: pagesFromStack(".sketchbook2"),
        };

        let activeBook = null;
        let pageIndex = 0;

        function updateIndicator() {
          if (!activeBook) {
            indicator.textContent = "— / —";
            return;
          }
          const total = books[activeBook].length;
          indicator.textContent = `${pageIndex + 1} / ${total}`;
        }

        function updateButtons() {
          const has = !!activeBook;
          prevBtn.disabled = !has || pageIndex <= 0;
          nextBtn.disabled = !has || pageIndex >= (has ? books[activeBook].length - 1 : 0);
        }

        function showMessage(msg) {
          viewerMsg.textContent = msg;
          viewerMsg.style.display = "block";
          viewerImg.style.display = "none";
          updateIndicator();
          updateButtons();
        }

        // Gentle preloader for neighbors
        function preload(src) {
          if (!src) return;
          const i = new Image();
          i.decoding = "async";
          i.src = src;
        }

        function showPage() {
          if (!activeBook) {
            showMessage("Select a sketchbook ↓");
            return;
          }
          const pages = books[activeBook];
          if (!pages || pages.length === 0) {
            showMessage("This sketchbook is empty.");
            return;
          }
          pageIndex = Math.max(0, Math.min(pageIndex, pages.length - 1));
          const src = pages[pageIndex];

          // Load the one image the user will see; neighbors are preloaded lightly
          viewerImg.setAttribute("fetchpriority", "high");
          viewerImg.decoding = "async";
          viewerImg.loading = "eager";
          viewerImg.src = src;
          viewerImg.alt = `Page ${pageIndex + 1} of ${activeBook}`;
          viewerImg.style.display = "block";
          viewerMsg.style.display = "none";

          // Preload neighbors
          preload(pages[pageIndex + 1]);
          preload(pages[pageIndex - 1]);

          updateIndicator();
          updateButtons();
        }

        function setBook(key) {
          if (!books[key] || books[key].length === 0) {
            activeBook = null;
            pageIndex = 0;
            showMessage("That sketchbook has no pages yet.");
            return;
          }
          activeBook = key;
          pageIndex = 0;
          showPage();
        }

        // Wire selector thumbs
        document.querySelectorAll(".chooseSketch img[data-target]").forEach((img) => {
          img.addEventListener("click", () => setBook(img.getAttribute("data-target")));
          img.setAttribute("tabindex", "0");
          img.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              setBook(img.getAttribute("data-target"));
            }
          });
          img.classList.add("thumb");
          // Make thumbs cheap to load
          img.setAttribute("loading", "lazy");
          img.setAttribute("fetchpriority", "low");
          img.decoding = "async";
        });

        // Buttons
        prevBtn.addEventListener("click", () => {
          if (!activeBook) return;
          if (pageIndex > 0) {
            pageIndex--;
            showPage();
          }
        });
        nextBtn.addEventListener("click", () => {
          if (!activeBook) return;
          const total = books[activeBook].length;
          if (pageIndex < total - 1) {
            pageIndex++;
            showPage();
          }
        });

        // Arrow keys
        window.addEventListener("keydown", (e) => {
          if (e.key === "ArrowLeft" && !prevBtn.disabled) prevBtn.click();
          if (e.key === "ArrowRight" && !nextBtn.disabled) nextBtn.click();
        });

        // Init
        showPage();
      })();
    </script>
  </body>
</html>
